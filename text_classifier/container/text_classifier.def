Bootstrap: docker
From: python:3.9-slim

%help
    Text classifier based on BERT transformer using PyTorch

%labels
    Author Your Name
    Version 1.0

%files
    pyproject.toml /app/pyproject.toml
    src/ /app/src/
    data/ /app/data/
    apptainer.env /app/.env

%post
    apt-get update && apt-get install -y \
        build-essential \
        curl \
        software-properties-common

    # Install uv
    pip install uv

    cd /app
    uv pip install --system -e .

    mkdir -p checkpoints

    apt-get clean
    rm -rf /var/lib/apt/lists/*

%environment
    export PYTHONPATH=/app:$PYTHONPATH
    export DEPLOYMENT_ENV=apptainer

%runscript
    cd /app
    python src/train.py

%test
    cd /app
    python -c "import torch; print('PyTorch version:', torch.__version__)"
    python -c "import transformers; print('Transformers version:', transformers.__version__)"